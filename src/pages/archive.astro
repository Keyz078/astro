---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.isDraft);
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const groupedPosts = {};

sortedPosts.forEach(post => {
  const year = post.data.date.getFullYear();
  const month = post.data.date.toLocaleString('en-EN', { month: 'long' });

  if (!groupedPosts[year]) {
    groupedPosts[year] = {};
  }
  if (!groupedPosts[year][month]) {
    groupedPosts[year][month] = [];
  }
  
  groupedPosts[year][month].push(post);
});
---
<BaseLayout pageTitle="Archives">
  <h1 class="!mt-0">Archives</h1>
  
  {Object.keys(groupedPosts).map(year => (
    <div class="mb-12">
      <h2 class="text-3xl font-bold border-b border-light-accent/20 pb-2 mb-6 dark:border-dark-accent/20">{year}</h2>
      
      {Object.keys(groupedPosts[year]).map(month => (
        <div class="mb-8">
          <h3 class="text-2xl font-semibold mb-4">{month}</h3>
          <ul class="list-none !p-0 space-y-2">

            {groupedPosts[year][month].map(post => (
              <li class="!pl-0">
                <a href={`/blog/${post.slug}/`} class="flex items-baseline gap-4 group">
                  <span class="text-gray-500 dark:text-gray-400 font-mono text-sm">{new Date(post.data.date).getDate().toString().padStart(2, '0')}</span>
                  <span class="text-lg group-hover:underline">{post.data.title}</span>
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>
  ))}
</BaseLayout>