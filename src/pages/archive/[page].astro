---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import type { Page } from 'astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('blog', ({ data }) => !data.isDraft);
  const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  
  return paginate(sortedPosts, { pageSize: 10 });
}

interface Props {
  page: Page<CollectionEntry<'blog'>>;
}

const { page } = Astro.props;
---
<BaseLayout pageTitle={`Arsip - Halaman ${page.currentPage}`}>
  <h1 class="!mt-0">Arsip Postingan</h1>
  <p>Menampilkan postingan di halaman {page.currentPage} dari {page.totalPages}.</p>
  
  {/* Kita akan menggunakan list yang sama seperti di index.astro */}
  <ul class="list-none !p-0 space-y-6 mt-8">
    {page.data.map(post => (
      <li class="!pl-0">
        <a href={`/blog/${post.slug}/`} class="block not-prose no-underline group p-4 rounded-md border border-transparent hover:border-light-accent/20 dark:hover:border-dark-accent/20">
          
          <div class="flex flex-col md:flex-row gap-6 items-start">
            
            {/* Logika kondisional untuk menampilkan gambar */}
            {post.data.cover ? (
              <img 
                src={post.data.cover} 
                alt={post.data.title}
                class="rounded-md w-full md:w-60 h-32 md:h-auto object-cover shrink-0"
                width="240"
                height="135"
              />
            ) : null}
            
            <div class={!post.data.cover ? 'w-full' : ''}>
              <h2 class="text-xl font-bold m-0 text-light-accent dark:text-dark-accent group-hover:underline">{post.data.title}</h2>
              <p class="text-base m-0 pt-1 text-light-text dark:text-dark-text">{post.data.description}</p>
              <p class="text-sm m-0 pt-2 text-gray-500 dark:text-gray-400">
                {new Date(post.data.pubDate).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}
              </p>
            </div>

          </div>
        </a>
      </li>
    ))}
  </ul>

  <div class="flex justify-between mt-8">
    {page.url.prev ? (
      <a href={page.url.prev} class="px-4 py-2 bg-light-accent/10 dark:bg-dark-accent/10 rounded-md hover:bg-light-accent/20 dark:hover:bg-dark-accent/20">&laquo; Preview</a>
    ) : <div></div>}
    
    {page.url.next ? (
      <a href={page.url.next} class="px-4 py-2 bg-light-accent/10 dark:bg-dark-accent/10 rounded-md hover:bg-light-accent/20 dark:hover:bg-dark-accent/20">Next &raquo;</a>
    ) : <div></div>}
  </div>
</BaseLayout>